---
title: "Visualising categorical data"
subtitle: "<br><br> Introduction to Data Science"
author: "[introds.org](https://introds.org/)"
date: "<br> Prof. Amy Herring"
output:
  xaringan::moon_reader:
    css: ["../../xaringan-themer.css", "../../slides.css"]
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightLines: true
      highlightStyle: solarized-light
      countIncrementalSlides: false
---

```{r child = "../../setup.Rmd"}
```

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(openintro)
loans_full_schema <- loans_full_schema %>%
  mutate(grade = factor(grade, ordered = TRUE))

gats <- readr::read_csv("/Users/amyherring/Documents/GitHub/198slides-f21/week-02/w2-d05-viz-cat/data/GATS_REV.csv")

gats$RESIDENCE=factor(gats$RESIDENCE,levels=c(1,2),labels=c("Urban","Rural"))
gats$PROVINCE=factor(gats$PROVINCE,levels=seq(1:31),labels=c("Beijing","Tianjin","Hebei","Shanxi","Neimenggu","Liaoning","Jilin","Heilongjiang","Shanghai","Jiangsu","Zhejiang","Anhui","Fujian","Jiangxi","Shangdong","Henan","Hubei","Hunan","Guangdong","Guangxi","Hainan","Chongqing","Sichuan","Guizhou","Yunnan","Xizang","Shaanxi","Gansu","Qinghai","Ningxia","Xinjiang"))
gats$REGION6=factor(gats$REGION6,levels=seq(1:6),labels=c("North","North-East","East","South-Central","South-West","North-West"))
gats$REGION3=factor(gats$REGION3,levels=seq(1:3),labels=c("East","Central","West"))
gats$GENDER=factor(gats$GENDER,levels=c(1,2),labels=c("Male","Female"))
gats$CURRENTSMOKE=factor(gats$CURRENTSMOKE,levels=c(1,2,7),labels=c("Yes","No","Don't Know"))
gats$EDUCATION=factor(gats$EDUCATION,levels=c(1,2,3,4,5,6,7,8,77,99),labels=c("None","Less than Primary School","Primary School","Less than Secondary School","Secondary School","High School","University","Postgraduate","Don't Know","Refused"))
gats$OCCUPATION=factor(gats$OCCUPATION,levels=c(1,2,3,4,5,6,7,8,9,10,77,99),labels=c("Farming","Government","Business","Teacher","Healthcare","Student","Soldier","Unemployed","Retired","Other","Don't Know","Refused"))
gats$HEARDOFECIG=factor(gats$HEARDOFECIG,levels=c(1,2,9),labels=c("Yes","No","Refused"))
gats$ECIGUSE=factor(gats$ECIGUSE,levels=c(1,2,3,9),labels=c("Daily","Less than Daily","Not at All","Refused"))
gats$TRYSTOP=factor(gats$TRYSTOP,levels=c(1,2,9),labels=c("Yes","No","Refused"))
gats$HOMESMOKERULES=factor(gats$HOMESMOKERULES,levels=c(1,2,3,4,7,9),labels=c("Allowed","Not Allowed but Exceptions","Never Allowed","No Rules","Don't Know","Refused"))
gats$SMOKESICK=factor(gats$SMOKESICK,levels=c(1,2,7,9),labels=c("Yes","No","Don't Know","Refused"))
gats$SMOKECANCER=factor(gats$SMOKECANCER,levels=c(1,2,7,9),labels=c("Yes","No","Don't Know","Refused"))
```

class: middle

# Recap

---

## Variables

- **Numerical** variables can be classified as **continuous** or **discrete** based on whether or not the variable can take on an infinite number of values.
- If the variable is **categorical**, we can determine if it is **ordinal** based on whether or not the levels have a natural ordering.

---

### Data 

```{r}
glimpse(gats)
```

---

class: middle

# Bar plot

---

## Bar plot

```{r}
ggplot(gats, aes(x = CURRENTSMOKE)) +
  geom_bar()
```

---

## Segmented bar plot

```{r}
ggplot(gats, aes(x = CURRENTSMOKE, 
                  fill = GENDER)) + #<<
  geom_bar()
```

---

## Segmented bar plot

```{r}
ggplot(gats, aes(x = CURRENTSMOKE, 
                  fill = GENDER)) +
  geom_bar(position = "fill")  #<<
```

---

.question[
Which bar plot is a more useful representation for visualizing the relationship between smoking and gender?
]

.pull-left[
```{r echo=FALSE, out.width = "100%"}
ggplot(gats, aes(x = CURRENTSMOKE, 
                  fill = GENDER)) + 
  geom_bar()
```
]
.pull-right[
```{r echo=FALSE, out.width = "100%"}
ggplot(gats, aes(x = CURRENTSMOKE, 
                  fill = GENDER)) +
  geom_bar(position = "fill")  
```
]

---

## Customizing bar plots

.panelset[
.panel[.panel-name[Plot]
```{r ref.label = "bar-custom", echo = FALSE, warning = FALSE}
```
]
.panel[.panel-name[Code]
```{r bar-custom, fig.show = "hide", warning = FALSE}

ggplot(gats, aes(y = CURRENTSMOKE, 
                  fill = GENDER)) +
  geom_bar(position = "fill")  +
  labs ( #<<
    x = "Proportion", #<<
    y = "Current Smoker?", #<<
    fill = "Gender", #<<
    title = "Smoking by Gender", #<<
    subtitle = "2018" #<<
    ) #<<

```
]
]

---

class: middle

# Relationships between numerical and categorical variables

---

## Already talked about...

- Colouring and faceting histograms and density plots
- Side-by-side box plots

---

## Violin plots

Violin plots are like boxplots, but instead of showing the quartiles (25th, 50th, and 75th %iles), they show rotated density plots on each side.

---

## Violin plots

```{r warning = FALSE}

ggplot(gats, aes(x = AGE, y = EDUCATION)) +
  geom_violin() 

```

---

## Ridge plots

Ridge plots also show density estimates across categorical groups

---

## Ridge plots

```{r warning = FALSE}
library(ggridges)
ggplot(gats, aes(x = AGE, y = EDUCATION, fill = EDUCATION, color = EDUCATION)) + 
  geom_density_ridges(alpha = 0.5)
```

